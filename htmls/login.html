<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Iniciar Sesión |ChileHub</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB" crossorigin="anonymous">
</head>
<body>
    <header>
        <nav class="navbar navbar-expand-lg" style="background-color: #8B0000;">
            <div class="container-fluid">
                <a class="navbar-brand" href="../htmls/index.html">
                    <img src="../images/ChileHub_Logo.png" alt="ChileHub" width="150">
                </a>
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse" id="navbarNavAltMarkup">
                    <div class="navbar-nav">
                        <a class="nav-link" href="../htmls/index.html">Inicio</a>
                        <a class="nav-link" href="../htmls/registro.html">Registro</a>
                        <a class="nav-link active" aria-current="page" href="../htmls/login.html">Iniciar Sesión</a>
                        <a class="nav-link" href="../htmls/sobre_nosotros.html">Sobre Nosotros</a>
                        <a class="nav-link" href="../htmls/listado_contenido.html">Listado de Contenido</a>
                    </div>
                </div>
            </div>
        </nav>
    </header>

<body>
    
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Login y Registro</title>
  <!-- bootstrap -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <!-- estilos -->
  <link rel="stylesheet" href="../css/iniciosession.css">
</head>
<body>
  <div class="d-flex justify-content-center align-items-center vh-100">
    <div class="card shadow-lg p-4 rounded-4 form-box">
      <h2 id="formTitle" class="text-center mb-3">Iniciar Sesión</h2>

      <!-- formulario login -->
      <div id="loginForm">
        <div class="mb-3">
          <input type="text" id="loginUsuario" class="form-control" placeholder="Usuario" required>
        </div>
        <div class="mb-3">
          <input type="password" id="loginPassword" class="form-control" placeholder="Contraseña" required>
        </div>
        <div class="form-check mb-3">
          <input type="checkbox" class="form-check-input" id="recordarSesion">
          <label for="recordarSesion" class="form-check-label">Recordar sesión</label>
        </div>
        <button class="btn btn-primary w-100" onclick="iniciarSesion()">Entrar</button>
        <p class="text-center mt-3">
          <a href="#" onclick="mostrarRegistro()">¿No tienes cuenta? Regístrate</a>
        </p>
      </div>

      <!-- formulario registro -->
      <div id="registerForm" style="display:none;">
        <div class="mb-3">
          <input type="email" id="regCorreo" class="form-control" placeholder="Correo" required>
        </div>
        <div class="mb-3">
          <input type="text" id="regUsuario" class="form-control" placeholder="Usuario" required>
        </div>
        <div class="mb-3">
          <input type="password" id="regPassword" class="form-control" placeholder="Contraseña (mínimo 8 caracteres)" required>
        </div>
        <div class="mb-3">
          <input type="tel" id="regTelefono" class="form-control" placeholder="Teléfono" required>
        </div>
        <button class="btn btn-success w-100" onclick="registrar()">Registrar</button>
        <p class="text-center mt-3">
          <a href="#" onclick="mostrarLogin()">¿Ya tienes cuenta? Inicia sesión</a>
        </p>
      </div>

      <div id="mensaje" class="text-center mt-2"></div>

      <!-- boton volver al inicio -->
      <div class="text-center mt-4">
        <a href="../htmls/index.html" class="btn btn-outline-secondary w-100">⬅ Volver al Inicio</a>
      </div>
    </div>
  </div>

  <!--bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script src="../JS/inicioscar.js"></script>
  <script>
    const mensaje = document.getElementById("mensaje");
    
    function mostrarRegistro() {
      document.getElementById("loginForm").style.display = "none";
      document.getElementById("registerForm").style.display = "block";
      document.getElementById("formTitle").innerText = "Registro";
      mensaje.innerText = "";
    }

    function mostrarLogin() {
      document.getElementById("loginForm").style.display = "block";
      document.getElementById("registerForm").style.display = "none";
      document.getElementById("formTitle").innerText = "Iniciar Sesión";
      mensaje.innerText = "";
    }

    function registrar() {
      const correo = document.getElementById("regCorreo").value;
      const usuario = document.getElementById("regUsuario").value;
      const password = document.getElementById("regPassword").value;
      const telefono = document.getElementById("regTelefono").value;

      if (password.length < 8) {
        mensaje.className = "text-danger";
        mensaje.innerText = "La contraseña debe tener al menos 8 caracteres.";
        return;
      }

      const usuarioData = { correo, usuario, password, telefono };
      localStorage.setItem("usuarioData", JSON.stringify(usuarioData));

      mensaje.className = "text-success";
      mensaje.innerText = "Registro exitoso. Ahora puedes iniciar sesión.";
      mostrarLogin();
    }

    function iniciarSesion() {
      const usuario = document.getElementById("loginUsuario").value;
      const password = document.getElementById("loginPassword").value;
      const recordar = document.getElementById("recordarSesion").checked;

      const usuarioData = JSON.parse(localStorage.getItem("usuarioData"));

      if (!usuarioData) {
        mensaje.className = "text-danger";
        mensaje.innerText = "No hay usuarios registrados.";
        return;
      }

      if (usuario === usuarioData.usuario && password === usuarioData.password) {
        mensaje.className = "text-success";
        mensaje.innerText = "Sesión iniciada correctamente.";

        if (recordar) {
          localStorage.setItem("sesionActiva", JSON.stringify(usuarioData));
        } else {
          sessionStorage.setItem("sesionActiva", JSON.stringify(usuarioData));
        }

        // redirige a la pagina
        setTimeout(() => {
          window.location.href = "../htmls/index.html";
        }, 1000);

      } else {
        mensaje.className = "text-danger";
        mensaje.innerText = "Usuario o contraseña incorrectos.";
      }
    }

    window.onload = function() {
      const sesionActiva = JSON.parse(localStorage.getItem("sesionActiva")) || JSON.parse(sessionStorage.getItem("sesionActiva"));
      if (sesionActiva) {
        // si ya hay sesion activa, tambien redirige
        window.location.href = "../htmls/index.html";
      }
    }
  </script>

</body>



</body>
</html>